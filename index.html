<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Planner</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/canvas.css">
    <link rel="stylesheet" href="css/panel.css">
    <link rel="stylesheet" href="css/modal.css">
</head>
<body>
    <!-- Main Container -->
    <div class="main-container">
        <!-- Canvas Area -->
        <div class="canvas-container">
            <canvas id="mainCanvas" width="800" height="600"></canvas>
        </div>

        <!-- Side Panel -->
        <aside id="sidePanel" class="side-panel">
            <!-- Control Section -->
            <section class="panel-section">
                <h2>Controls</h2>
                <button id="roomSetupBtn" class="btn-block">Room Setup</button>
                <button id="addObjectBtn" class="btn-block">Add Object</button>
                <button id="addWindowBtn" class="btn-block" disabled>Add Window</button>
                <button id="addDoorBtn" class="btn-block" disabled>Add Door</button>
                <button id="exportBtn" class="btn-block">Export View</button>
            </section>

            <!-- Statistics Section -->
            <section class="panel-section">
                <h2>Statistics</h2>
                <div class="stat-item">
                    <span class="stat-label">Floor Space:</span>
                    <span id="statFloorSpace" class="stat-value">0 m¬≤</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Space Used:</span>
                    <span id="statSpaceUsed" class="stat-value">0%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Objects:</span>
                    <span id="statObjectCount" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Volume:</span>
                    <span id="statTotalVolume" class="stat-value">0 m¬≥</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Tallest Object:</span>
                    <span id="statTallestObject" class="stat-value">0 m</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Remaining Height:</span>
                    <span id="statRemainingHeight" class="stat-value">0 m</span>
                </div>
            </section>
        </aside>

        <!-- Right Panel - Object List -->
        <aside id="rightPanel" class="right-panel">
            <!-- Objects Section -->
            <section class="panel-section">
                <h2>Objects</h2>
                <div id="objectList" class="object-list">
                    <p class="empty-message">No objects yet</p>
                </div>
            </section>

            <!-- Doors Section -->
            <section class="panel-section">
                <h2>Doors</h2>
                <div id="doorList" class="object-list">
                    <p class="empty-message">No doors yet</p>
                </div>
            </section>

            <!-- Windows Section -->
            <section class="panel-section">
                <h2>Windows</h2>
                <div id="windowList" class="object-list">
                    <p class="empty-message">No windows yet</p>
                </div>
            </section>
        </aside>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-left">
            <button id="togglePanelBtn" class="btn-icon" title="Toggle Panel">‚ò∞</button>
            <div class="view-selector">
                <button class="view-btn active" data-view="TOP" title="Top View (1)">1</button>
                <button class="view-btn" data-view="FRONT" title="Front View (2)">2</button>
                <button class="view-btn" data-view="LEFT" title="Left View (3)">3</button>
                <button class="view-btn" data-view="RIGHT" title="Right View (4)">4</button>
            </div>
        </div>
        <div class="footer-right">
            <span id="viewIndicator" class="view-indicator">Top View</span>
            <span id="modeIndicator" class="mode-indicator">Ready</span>
            <button id="helpBtn" class="btn-icon" title="Keyboard Shortcuts (?)">?</button>
            <button id="toggleRightPanelBtn" class="btn-icon" title="Toggle Object List">‚ãÆ</button>
        </div>
    </footer>

    <!-- Room Setup Modal -->
    <div id="roomModal" class="modal">
        <div class="modal-content">
            <h2>Room Setup</h2>
            <form id="roomForm">
                <div class="form-group">
                    <label for="roomWidth">Width (m):</label>
                    <input type="number" id="roomWidth" min="1" max="20" value="4" step="0.1" required>
                </div>
                <div class="form-group">
                    <label for="roomLength">Length (m):</label>
                    <input type="number" id="roomLength" min="1" max="20" value="5" step="0.1" required>
                </div>
                <div class="form-group">
                    <label for="roomHeight">Height (m):</label>
                    <input type="number" id="roomHeight" min="1" max="5" value="2.5" step="0.1" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelRoomBtn">Cancel</button>
                    <button type="submit" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Object Creation Modal -->
    <div id="objectModal" class="modal">
        <div class="modal-content">
            <h2>Create Object</h2>
            <form id="objectForm">
                <div class="form-group">
                    <label for="objectName">Name:</label>
                    <input type="text" id="objectName" placeholder="Auto-numbered" required>
                </div>
                <div class="form-group">
                    <label for="objectWidth">Width (m):</label>
                    <input type="number" id="objectWidth" min="0.01" max="10" value="1" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="objectLength">Length (m):</label>
                    <input type="number" id="objectLength" min="0.01" max="10" value="1" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="objectHeight">Height (m):</label>
                    <input type="number" id="objectHeight" min="0.01" max="3" value="0.8" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="objectColor">Color:</label>
                    <input type="color" id="objectColor" value="#4A90E2">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelObjectBtn">Cancel</button>
                    <button type="submit" class="btn-primary">Create & Place</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Object Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content modal-edit">
            <h2>Edit Object</h2>
            <form id="editForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editName">Name:</label>
                        <input type="text" id="editName" placeholder="e.g., Sofa, Table" required>
                    </div>
                    <div class="form-group">
                        <label for="editColor">Color:</label>
                        <input type="color" id="editColor">
                    </div>
                </div>

                <h3 class="section-title">Dimensions</h3>
                <div class="form-grid form-grid-3">
                    <div class="form-group">
                        <label for="editWidth">Width (m):</label>
                        <input type="number" id="editWidth" min="0.01" max="10" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="editLength">Length (m):</label>
                        <input type="number" id="editLength" min="0.01" max="10" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="editHeight">Height (m):</label>
                        <input type="number" id="editHeight" min="0.01" max="3" step="0.01" required>
                    </div>
                </div>

                <h3 class="section-title">Position <span style="font-size: 0.75rem; font-weight: normal; color: var(--text-secondary);">(Z = height above ground)</span></h3>
                <div class="form-grid form-grid-3">
                    <div class="form-group">
                        <label for="editPosX">X (m):</label>
                        <input type="number" id="editPosX" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="editPosY">Y (m):</label>
                        <input type="number" id="editPosY" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="editPosZ">Z (m) üìè:</label>
                        <input type="number" id="editPosZ" min="0" step="0.01" required>
                    </div>
                </div>
                <div style="background: var(--bg-color); padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-secondary); border-left: 3px solid var(--primary-color);">
                    üí° Tip: Objects automatically stack when placed on others with collision disabled. Z position is calculated automatically!
                </div>

                <div class="form-group form-group-checkbox">
                    <label class="checkbox-label">
                        <input type="checkbox" id="editCollision">
                        <span>Enable Collision Detection</span>
                    </label>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelEditBtn">Cancel</button>
                    <button type="submit" class="btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" id="editObjectMenu">Edit Object</div>
        <div class="context-menu-item" id="duplicateObjectMenu">Duplicate Object</div>
        <div class="context-menu-item" id="deleteObjectMenu">Delete Object</div>
        <div class="context-menu-item" id="toggleCollisionMenu">Toggle Collision</div>
    </div>

    <!-- List Item Context Menu -->
    <div id="listContextMenu" class="context-menu">
        <div class="context-menu-item" id="listEditObjectMenu">Edit Object</div>
        <div class="context-menu-item" id="listDuplicateObjectMenu">Duplicate Object</div>
        <div class="context-menu-item" id="listToggleVisibilityMenu">Toggle Visibility</div>
        <div class="context-menu-item" id="listToggleCollisionMenu">Toggle Collision</div>
        <div class="context-menu-item" id="listDeleteObjectMenu">Delete Object</div>
    </div>

    <!-- Batch Operations Context Menu -->
    <div id="batchContextMenu" class="context-menu">
        <div class="context-menu-item" id="batchToggleVisibilityMenu">Toggle Visibility</div>
        <div class="context-menu-item" id="batchToggleCollisionMenu">Toggle Collision</div>
        <div class="context-menu-item" id="batchDeleteMenu">Delete Selected</div>
        <div class="context-menu-item" id="batchDeselectMenu">Deselect All</div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content modal-help">
            <h2>Keyboard Shortcuts</h2>
            <div class="shortcuts-container">
                <div class="shortcuts-section">
                    <h3>Views</h3>
                    <div class="shortcut-item">
                        <kbd>1</kbd>
                        <span>Top View</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>2</kbd>
                        <span>Front View</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>3</kbd>
                        <span>Left View</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>4</kbd>
                        <span>Right View</span>
                    </div>
                </div>

                <div class="shortcuts-section">
                    <h3>Object Actions</h3>
                    <div class="shortcut-item">
                        <kbd>R</kbd>
                        <span>Rotate Selected</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>D</kbd>
                        <span>Duplicate Selected</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>H</kbd>
                        <span>Hide/Show Selected</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>C</kbd>
                        <span>Toggle Collision</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Delete</kbd>
                        <span>Delete Selected</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Escape</kbd>
                        <span>Deselect</span>
                    </div>
                </div>

                <div class="shortcuts-section">
                    <h3>Selection</h3>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>Click</kbd>
                        <span>Multi-Select (List or Canvas)</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>A</kbd>
                        <span>Select All</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>E</kbd>
                        <span>Deselect All</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Drag</kbd>
                        <span>Move Selected Objects</span>
                    </div>
                </div>

                <div class="shortcuts-section">
                    <h3>Interface</h3>
                    <div class="shortcut-item">
                        <kbd>?</kbd>
                        <span>Show This Help</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>\</kbd>
                        <span>Toggle Left Panel</span>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-primary" id="closeHelpBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript Modules -->
    <!-- Utilities -->
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/geometry.js"></script>
    <script src="js/utils/drawing.js"></script>

    <!-- Core -->
    <script src="js/core/eventBus.js"></script>
    <script src="js/core/viewport.js"></script>

    <!-- Features -->
    <script src="js/features/room/Room.js"></script>
    <script src="js/features/room/RoomController.js"></script>
    <script src="js/features/room/RoomRenderer.js"></script>
    <script src="js/features/room/RoomView.js"></script>

    <script src="js/features/objects/PlaceableObject.js"></script>
    <script src="js/features/objects/ObjectManager.js"></script>
    <script src="js/features/objects/ObjectController.js"></script>
    <script src="js/features/objects/ObjectRenderer.js"></script>
    <script src="js/features/objects/ObjectView.js"></script>
    <script src="js/features/objects/ObjectListView.js"></script>

    <!-- Views -->
    <script src="js/features/views/ViewManager.js"></script>
    <script src="js/features/views/ViewRenderer.js"></script>

    <!-- Services -->
    <script src="js/services/StatisticsService.js"></script>
    <script src="js/services/CollisionService.js"></script>

    <!-- App Bootstrap -->
    <script src="js/core/app.js"></script>
</body>
</html>
